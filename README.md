# Reusable GitHub Actions Workflows

This repository contains **multiple reusable GitHub Actions workflows** with distinct purposes. Each workflow can be called independently or chained together, depending on the project needs. Currently included:

1. **Build & Release Workflow** – Packages the project into a zip and publishes a GitHub release.
2. **PHP Unit Tests Workflow** – Runs PHPUnit tests across multiple PHP versions with optional multisite support.
3. **Sync Folders Workflow** – Synchronizes local project folders to a remote server via SSH.

---

## Features

- Centralized build and release process.
- Multi-version PHP testing.
- Safe folder synchronization with configurable mappings.
- Reusable across multiple projects.

---

## Build & Release Workflow

### Inputs

| Name | Description | Required | Default |
|------|-------------|----------|---------|
| `output_dir` | Directory where build artifacts and the zip file are placed | No | `build` |

> The `output_dir` input allows avoiding conflicts with existing directories and can be customized per project.

### Outputs

| Name | Description |
|------|-------------|
| `package_file` | Name of the zip file generated by the build job, used in the release job |

### Usage Example

```yaml
jobs:
  call_shared_release:
    uses: WritePoetry/reusable-workflows/.github/workflows/release.yml@v1
    with:
      output_dir: 'custom-build-folder'
    permissions:
      contents: write
      packages: read
      actions: read
    secrets: inherit
```


### Plugin File Naming

The final zip file name is formed as:

`<package-name>-<version>.zip`


- `<package-name>` is read from the `name` field in `package.json`.
- `<version>` is derived from the Git tag being built (`GITHUB_REF_NAME` without the `v` prefix).
- Example: For `package.json` with `"name": "my-plugin"` and tag `v1.2.3`, the zip will be named `my-plugin-1.2.3.zip`.

## Usage

### Calling from another workflow
You can invoke this reusable workflow from another workflow in your repository or from a different repository.  
This allows you to centralize your build and release process, ensuring consistent artifact creation and release steps across multiple projects.

Example usage:

```yaml
jobs:
  run_tests_first:
    uses: WritePoetry/reusable-workflows/.github/workflows/php-tests.yml@v1
    with:
      php_versions: "['8.2','8.3']" 
    secrets: inherit

  call_shared_release:
    needs: run_tests_first
    uses: WritePoetry/reusable-workflows/.github/workflows/release.yml@v1
    with:
      output_dir: 'custom-build-folder' #Passes a custom output directory to the workflow.
    permissions:
      contents: write
      packages: read
      actions: read
    secrets: inherit
```


## Package Contents

The final release zip contains exactly the files declared in the project's `package.json` under the `files` field.  
Example:

```json
"files": [
  "vendor",
  "ExamplePlugin.php"
]
```

Only these paths are packaged, unless additional assets are generated inside those same directories during the build.


### Required npm Scripts

The workflow relies on the following npm script, which is specific to WordPress projects:

```json
"plugin-zip": "wp-scripts plugin-zip"
```
This command is responsible for creating the initial zip before renaming.
If it is missing, the workflow cannot produce the release artifact.



### Required npm Dependencies

The workflow requires the WordPress build tooling provided by `@wordpress/scripts` because `wp-scripts plugin-zip` is part of the WordPress tooling ecosystem.  
Install it as a development dependency:

```bash
npm install --save-dev @wordpress/scripts
```
This package is specific to WordPress projects and must be installed for the build and zip steps to function.

### Required Node and npm Versions
The project must also provide valid `engines` fields specifying Node and npm versions, since the workflow uses `actions/setup-node` and relies on the project's version declarations:

```json
"engines": {
  "node": "22.18.0",
  "npm": "10.9.3"
}
```

### Workflow Flow

**Build job**
- Checks out the code.
- Installs dependencies.
- Runs the build.
- Zips the package.
- Uploads the artifact.
- Exposes the zip filename as an output.

**Release job**
- Downloads the artifact from the build job.
- Creates a GitHub Release using the generated zip file.

### Notes

- The workflow is fully reusable and can be shared across multiple projects.
- Artifacts are transferred between jobs using `upload-artifact` and `download-artifact`.
- Output variables are used only to reference filenames, not to transfer files.
